<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BONK Admin Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="database.js"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f9fafb;
        }
        .transition-card {
            transition: all 0.3s ease;
        }
        .transition-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="bg-white border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex">
                    <div class="flex-shrink-0 flex items-center">
                        <img src="/api/placeholder/32/32" alt="Logo" class="h-8 w-8 mr-2">
                        <span class="font-bold text-xl text-gray-800">BONK Admin</span>
                    </div>
                    <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                        <a href="#" class="border-indigo-500 text-gray-900 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Dashboard
                        </a>
                        <a href="#" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Content
                        </a>
                        <a href="#" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Users
                        </a>
                        <a href="#" class="border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium">
                            Reports
                        </a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="lastSync" class="text-sm text-gray-500"></span>
                    <button onclick="refreshData()" class="p-2 rounded-full hover:bg-gray-100">
                        <i data-feather="refresh-cw" class="w-5 h-5 text-gray-500"></i>
                    </button>
                    <button onclick="logout()" class="bg-red-500 text-white px-4 py-2 rounded-md hover:bg-red-600 transition-colors">
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
        <!-- Overview Stats -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-5 mb-6">
            <div class="bg-white rounded-lg p-6 shadow-sm transition-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500">Total Users</h3>
                    <span class="p-2 bg-blue-50 rounded-md">
                        <i data-feather="users" class="w-5 h-5 text-blue-500"></i>
                    </span>
                </div>
                <div class="flex items-baseline">
                    <p class="text-2xl font-semibold text-gray-900" id="totalUsers">-</p>
                    <p class="ml-2 text-sm text-green-600 font-medium" id="userGrowth">
                        <i data-feather="arrow-up" class="w-4 h-4 inline"></i>
                        <span>-</span>
                    </p>
                </div>
            </div>

            <div class="bg-white rounded-lg p-6 shadow-sm transition-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500">Total BONK</h3>
                    <span class="p-2 bg-indigo-50 rounded-md">
                        <i data-feather="dollar-sign" class="w-5 h-5 text-indigo-500"></i>
                    </span>
                </div>
                <div class="flex items-baseline">
                    <p class="text-2xl font-semibold text-gray-900" id="totalBonk">-</p>
                    <p class="ml-2 text-sm text-green-600 font-medium" id="bonkGrowth">
                        <i data-feather="arrow-up" class="w-4 h-4 inline"></i>
                        <span>-</span>
                    </p>
                </div>
            </div>

            <div class="bg-white rounded-lg p-6 shadow-sm transition-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500">Active Content</h3>
                    <span class="p-2 bg-green-50 rounded-md">
                        <i data-feather="activity" class="w-5 h-5 text-green-500"></i>
                    </span>
                </div>
                <div class="flex items-baseline">
                    <p class="text-2xl font-semibold text-gray-900" id="activeContent">-</p>
                    <p class="ml-2 text-sm text-green-600 font-medium" id="contentGrowth">
                        <i data-feather="arrow-up" class="w-4 h-4 inline"></i>
                        <span>-</span>
                    </p>
                </div>
            </div>

            <div class="bg-white rounded-lg p-6 shadow-sm transition-card">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-sm font-medium text-gray-500">Completion Rate</h3>
                    <span class="p-2 bg-purple-50 rounded-md">
                        <i data-feather="percent" class="w-5 h-5 text-purple-500"></i>
                    </span>
                </div>
                <div class="flex items-baseline">
                    <p class="text-2xl font-semibold text-gray-900" id="completionRate">-</p>
                    <p class="ml-2 text-sm text-green-600 font-medium" id="completionGrowth">
                        <i data-feather="arrow-up" class="w-4 h-4 inline"></i>
                        <span>-</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Content Management -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
            <!-- PTC Ads Management -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-lg font-semibold text-gray-900">PTC Ads</h2>
                    <button onclick="openModal('createPtcAdModal')" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <i data-feather="plus" class="w-4 h-4 mr-2"></i>
                        Add New
                    </button>
                </div>
                <div class="space-y-4" id="ptcAdsList"></div>
            </div>

            <!-- Shortlinks Management -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-lg font-semibold text-gray-900">Shortlinks</h2>
                    <button onclick="openModal('createShortlinkModal')" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <i data-feather="plus" class="w-4 h-4 mr-2"></i>
                        Add New
                    </button>
                </div>
                <div class="space-y-4" id="shortlinksList"></div>
            </div>

            <!-- Tasks Management -->
            <div class="bg-white rounded-lg shadow-sm p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-lg font-semibold text-gray-900">Tasks</h2>
                    <button onclick="openModal('createTaskModal')" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                        <i data-feather="plus" class="w-4 h-4 mr-2"></i>
                        Add New
                    </button>
                </div>
                <div class="space-y-4" id="tasksList"></div>
            </div>
        </div>

        <!-- Analytics Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Daily Activity</h2>
                <canvas id="activityChart" height="300"></canvas>
            </div>
            <div class="bg-white rounded-lg shadow-sm p-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">Earnings Distribution</h2>
                <canvas id="earningsChart" height="300"></canvas>
            </div>
        </div>
    </div>

    <!-- Create PTC Ad Modal -->
    <div id="createPtcAdModal" class="fixed inset-0 bg-black bg-opacity-50 hidden" aria-hidden="true">
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Create PTC Ad</h3>
                    <button onclick="closeModal('createPtcAdModal')" class="text-gray-400 hover:text-gray-500">
                        <i data-feather="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <form id="ptcAdForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Title</label>
                        <input type="text" name="title" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">URL</label>
                        <input type="url" name="url" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">View Duration (10-180 seconds)</label>
                        <input type="number" name="viewDuration" min="10" max="180" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">BONK Reward</label>
                        <input type="number" name="bonkReward" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div class="mt-4 flex justify-end space-x-3">
                        <button type="button" onclick="closeModal('createPtcAdModal')" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Create
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Shortlink Modal -->
    <div id="createShortlinkModal" class="fixed inset-0 bg-black bg-opacity-50 hidden" aria-hidden="true">
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Create Shortlink</h3>
                    <button onclick="closeModal('createShortlinkModal')" class="text-gray-400 hover:text-gray-500">
                        <i data-feather="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <form id="shortlinkForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Title</label>
                        <input type="text" name="title" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">URL</label>
                        <input type="url" name="url" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">BONK Reward</label>
                        <input type="number" name="bonkReward" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div class="mt-4 flex justify-end space-x-3">
                        <button type="button" onclick="closeModal('createShortlinkModal')" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Create
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Task Modal -->
    <div id="createTaskModal" class="fixed inset-0 bg-black bg-opacity-50 hidden" aria-hidden="true">
        <div class="fixed inset-0 flex items-center justify-center p-4">
            <div class="bg-white rounded-lg max-w-md w-full p-6">
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-lg font-semibold text-gray-900">Create Task</h3>
                    <button onclick="closeModal('createTaskModal')" class="text-gray-400 hover:text-gray-500">
                        <i data-feather="x" class="w-5 h-5"></i>
                    </button>
                </div>
                <form id="taskForm" class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Title</label>
                        <input type="text" name="title" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Description</label>
                        <textarea name="description" required rows="3" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500"></textarea>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">BONK Reward</label>
                        <input type="number" name="bonkReward" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700">Task Type</label>
                        <select name="type" required class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500">
                            <option value="social">Social Media</option>
                            <option value="website">Website</option>
                            <option value="survey">Survey</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div class="mt-4 flex justify-end space-x-3">
                        <button type="button" onclick="closeModal('createTaskModal')" class="px-4 py-2 border border-gray-300 rounded-md text-sm font-medium text-gray-700 hover:bg-gray-50">
                            Cancel
                        </button>
                        <button type="submit" class="px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                            Create
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Initialize Feather Icons
        feather.replace();

        // Global Variables
        let lastUpdate = new Date();
        let charts = {};

        // Initialize Data and UI
        async function initializeAdmin() {
            await loadDashboardData();
            initializeCharts();
            setupEventListeners();
            startAutoRefresh();
        }

        // Load Dashboard Data
        async function loadDashboardData() {
            try {
                const data = await DATABASE.api.getAllData();
                updateStatistics(data);
                updateContentLists(data);
                updateLastSync();
            } catch (error) {
                console.error('Error loading dashboard data:', error);
                showNotification('Error loading data', 'error');
            }
        }

        // Update Statistics
        function updateStatistics(data) {
            const stats = calculateStatistics(data);
            
            // Update counters with animation
            animateCounter('totalUsers', stats.totalUsers);
            animateCounter('totalBonk', stats.totalBonk);
            animateCounter('activeContent', stats.activeContent);
            animateCounter('completionRate', stats.completionRate, '%');

            // Update growth indicators
            updateGrowthIndicator('userGrowth', stats.userGrowth);
            updateGrowthIndicator('bonkGrowth', stats.bonkGrowth);
            updateGrowthIndicator('contentGrowth', stats.contentGrowth);
            updateGrowthIndicator('completionGrowth', stats.completionGrowth);

            // Update charts
            updateChartData(charts.activityChart, stats.activityData);
            updateChartData(charts.earningsChart, stats.earningsData);
        }

        // Calculate Statistics
        function calculateStatistics(data) {
            const users = Object.values(data.users || {});
            const ptcAds = data.ptcAds || [];
            const shortlinks = data.shortlinks || [];
            const tasks = data.tasks || [];

            return {
                totalUsers: users.length,
                totalBonk: users.reduce((sum, user) => sum + (user.bonkBalance || 0), 0),
                activeContent: ptcAds.filter(ad => ad.status === 'active').length +
                             shortlinks.filter(link => link.status === 'active').length +
                             tasks.filter(task => task.status === 'active').length,
                completionRate: calculateCompletionRate(data),
                userGrowth: calculateGrowth('users', data),
                bonkGrowth: calculateGrowth('bonk', data),
                contentGrowth: calculateGrowth('content', data),
                completionGrowth: calculateGrowth('completion', data),
                activityData: generateActivityData(data),
                earningsData: generateEarningsData(data)
            };
        }

        // Content Management Functions
        async function createPtcAd(formData) {
            try {
                const adminId = localStorage.getItem('adminId');
                const adData = {
                    title: formData.get('title'),
                    url: formData.get('url'),
                    viewDuration: parseInt(formData.get('viewDuration')),
                    bonkReward: parseInt(formData.get('bonkReward'))
                };

                const newAd = await DATABASE.contentManagement.createPtcAd(adminId, adData);
                if (newAd) {
                    showNotification('PTC Ad created successfully', 'success');
                    closeModal('createPtcAdModal');
                    await loadDashboardData();
                }
            } catch (error) {
                console.error('Error creating PTC ad:', error);
                showNotification(error.message, 'error');
            }
        }

        async function createShortlink(formData) {
            try {
                const adminId = localStorage.getItem('adminId');
                const shortlinkData = {
                    title: formData.get('title'),
                    url: formData.get('url'),
                    bonkReward: parseInt(formData.get('bonkReward'))
                };

                const newShortlink = await DATABASE.contentManagement.createShortlink(adminId, shortlinkData);
                if (newShortlink) {
                    showNotification('Shortlink created successfully', 'success');
                    closeModal('createShortlinkModal');
                    await loadDashboardData();
                }
            } catch (error) {
                console.error('Error creating shortlink:', error);
                showNotification(error.message, 'error');
            }
        }

        async function createTask(formData) {
            try {
                const adminId = localStorage.getItem('adminId');
                const taskData = {
                    title: formData.get('title'),
                    description: formData.get('description'),
                    bonkReward: parseInt(formData.get('bonkReward')),
                    type: formData.get('type')
                };

                const newTask = await DATABASE.contentManagement.createTask(adminId, taskData);
                if (newTask) {
                    showNotification('Task created successfully', 'success');
                    closeModal('createTaskModal');
                    await loadDashboardData();
                }
            } catch (error) {
                console.error('Error creating task:', error);
                showNotification(error.message, 'error');
            }
        }

        // UI Helper Functions
        function showNotification(message, type = 'success') {
            // Implementation of notification system
        }

        function openModal(modalId) {
            document.getElementById(modalId).classList.remove('hidden');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function updateLastSync() {
            lastUpdate = new Date();
            document.getElementById('lastSync').textContent = 
                `Last updated: ${lastUpdate.toLocaleTimeString()}`;
        }

        // Event Listeners Setup
        function setupEventListeners() {
            // Form submissions
            document.getElementById('ptcAdForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await createPtcAd(new FormData(e.target));
            });

            document.getElementById('shortlinkForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await createShortlink(new FormData(e.target));
            });

            document.getElementById('taskForm').addEventListener('submit', async (e) => {
                e.preventDefault();
                await createTask(new FormData(e.target));
            });
        }

        // Auto Refresh
        function startAutoRefresh() {
            setInterval(async () => {
                await loadDashboardData();
            }, 30000); // Refresh every 30 seconds
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializeAdmin);
    </script>
</body>
</html>
