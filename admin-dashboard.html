<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BONK Coin Admin Paneli</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-color: #F8FAFC;
            --text-color: #1E293B; 
            --primary-color: #6366F1;
            --card-bg: #FFFFFF;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body>
    <div class="min-h-screen flex">
        <!-- Sidebar -->
        <aside class="w-64 bg-white border-r">
            <div class="px-6 py-8">
                <img src="https://raw.githubusercontent.com/bonk-coin/brand-assets/main/bonk-logo.png" alt="BONK Logo" class="h-10 mx-auto mb-4">
                <nav>
                    <ul>
                        <li>
                            <a href="#" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-indigo-700 hover:text-white">
                                <span class="mr-2">üìä</span>
                                <span>Dashboard</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-indigo-700 hover:text-white">
                                <span class="mr-2">üë•</span>
                                <span>Kullanƒ±cƒ±lar</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-indigo-700 hover:text-white">
                                <span class="mr-2">üéÆ</span>
                                <span>Oyunlar</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-indigo-700 hover:text-white">
                                <span class="mr-2">üéÅ</span>
                                <span>Kampanyalar</span>
                            </a>
                        </li>
                        <li>
                            <a href="#" class="block py-2.5 px-4 rounded transition duration-200 hover:bg-indigo-700 hover:text-white">
                                <span class="mr-2">‚öôÔ∏è</span>
                                <span>Ayarlar</span>
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="flex-1 px-10 py-8">
          
            <!-- Dashboard Header -->
            <div class="mb-8">
                <h1 class="text-3xl font-semibold mb-4">BONK Admin Paneli</h1>
                <p class="text-gray-600">Airdrop ve oyun istatistiklerini buradan y√∂netin</p>
            </div>

            <!-- Stats Overview -->
            <section class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg p-6 shadow-md flex items-center">
                    <div class="p-3 rounded-full bg-indigo-600 bg-opacity-75 text-white mr-4">
                        <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                        </svg>
                    </div>
                    <div>
                        <p class="mb-2 text-sm font-medium text-gray-600">
                            Toplam Kullanƒ±cƒ±
                        </p>
                        <p class="text-lg font-semibold text-gray-700" id="totalUsers">
                            -
                        </p>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-6 shadow-md flex items-center">
                    <div class="p-3 rounded-full bg-green-600 bg-opacity-75 text-white mr-4">
                        <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                    <div>
                        <p class="mb-2 text-sm font-medium text-gray-600">
                            Toplam BONK
                        </p>
                        <p class="text-lg font-semibold text-gray-700" id="totalBonk">
                            -
                        </p>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-6 shadow-md flex items-center">
                    <div class="p-3 rounded-full bg-yellow-600 bg-opacity-75 text-white mr-4">
                        <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z" />
                        </svg>
                    </div>
                    <div>
                        <p class="mb-2 text-sm font-medium text-gray-600">
                            Oyun Oynama
                        </p>
                        <p class="text-lg font-semibold text-gray-700" id="totalPlays">
                            -
                        </p>
                    </div>
                </div>

                <div class="bg-white rounded-lg p-6 shadow-md flex items-center">
                    <div class="p-3 rounded-full bg-blue-600 bg-opacity-75 text-white mr-4">
                        <svg class="h-8 w-8" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z" />
                        </svg>
                    </div>
                    <div>
                        <p class="mb-2 text-sm font-medium text-gray-600">
                            Toplam Referans  
                        </p>
                        <p class="text-lg font-semibold text-gray-700" id="totalReferrals">
                            -
                        </p>
                    </div>
                </div>
            </section>

            <!-- User Growth Chart -->
            <section class="bg-white rounded-lg p-6 shadow-md mb-8">
                <h2 class="text-xl font-semibold mb-4">Kullanƒ±cƒ± Artƒ±≈üƒ±</h2>
                <canvas id="userGrowthChart"></canvas>  
            </section>

            <!-- Game Stats -->
            <section class="grid md:grid-cols-2 gap-6">
                <div class="bg-white rounded-lg p-6 shadow-md">
                    <h2 class="text-xl font-semibold mb-4">Oyun ƒ∞statistikleri</h2>
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-200 text-gray-600 text-sm leading-normal">
                                <th class="py-3 px-4 text-left">Oyun</th>
                                <th class="py-3 px-4 text-left">Oynama</th>
                                <th class="py-3 px-4 text-left">Kazanƒ±lan BONK</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-600 text-sm" id="gameStatsTable">
                            <!-- Oyun istatistikleri buraya gelecek -->
                        </tbody>
                    </table>
                </div>

                <!-- Top Referrers -->
                <div class="bg-white rounded-lg p-6 shadow-md">
                    <h2 class="text-xl font-semibold mb-4">En √áok Referans Yapanlar</h2>  
                    <table class="w-full table-auto">
                        <thead>
                            <tr class="bg-gray-200 text-gray-600 text-sm leading-normal">
                                <th class="py-3 px-4 text-left">Kullanƒ±cƒ±</th>
                                <th class="py-3 px-4 text-left">Referans Sayƒ±sƒ±</th>
                            </tr>
                        </thead>
                        <tbody class="text-gray-600 text-sm" id="topReferrersTable">
                            <!-- En √ßok referans yapanlar buraya gelecek -->  
                        </tbody>
                    </table>
                </div>
            </section>
           
        </main>
    </div>

    <script>
        async function fetchStats() {
            try {
                const stats = await DATABASE.stats.getGlobalStats();
                console.log('Global stats:', stats);

                // Update UI with fetched stats
                document.getElementById('totalUsers').textContent = stats.totalUsers;
                document.getElementById('totalBonk').textContent = stats.totalBonk;
                document.getElementById('totalPlays').textContent = Object.values(stats.gameStats)
                    .reduce((sum, game) => sum + game.totalPlays, 0);
                document.getElementById('totalReferrals').textContent = stats.referralStats.totalReferrals;

                // Render game stats table
                const gameStatsHtml = Object.entries(stats.gameStats)
                    .map(([game, data]) => `
                        <tr class="border-b border-gray-200">
                            <td class="py-3 px-4">${game}</td>  
                            <td class="py-3 px-4">${data.totalPlays}</td>
                            <td class="py-3 px-4">${data.totalBonkEarned}</td>
                        </tr>
                    `)
                    .join('');
                document.getElementById('gameStatsTable').innerHTML = gameStatsHtml;
                
                // Render top referrers table
                const topReferrersHtml = stats.referralStats.topReferrers
                    .map(referrer => `
                        <tr class="border-b border-gray-200">
                            <td class="py-3 px-4">${referrer.userId}</td>
                            <td class="py-3 px-4">${referrer.referralCount}</td>
                        </tr>
                    `)
                    .join('');
                document.getElementById('topReferrersTable').innerHTML = topReferrersHtml;

                // Render user growth chart
                renderUserGrowthChart(stats.newUsersByDay);
                
            } catch (error) {
                console.error('Error fetching stats:', error);
            }
        }

        function renderUserGrowthChart(growthData) {
            const ctx = document.getElementById('userGrowthChart').getContext('2d');

            // Group new users by day
            const newUsersByDay = Object.entries(growthData).map(([date, count]) => ({
                date,
                count
            }));

            // Sort by date ascending
            newUsersByDay.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Extract labels and data
            const labels = newUsersByDay.map(entry => entry.date);  
            const data = newUsersByDay.map(entry => entry.count);

            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Yeni Kullanƒ±cƒ±lar',
                        data: data,
                        fill: false,  
                        borderColor: 'rgb(99, 102, 241)',
                        tension: 0.1
                    }]
                }
            });
        }

        // Fetch stats on page load
        fetchStats();
    </script>
</body>
</html>
