<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Flappy BONK</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="database.js"></script>
    <script src='//whephiwums.com/vignette.min.js' data-zone='8946116' data-sdk='show_8946116'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: #1A1B1E;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            overflow: hidden;
            position: relative;
        }

        #gameWrapper {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100vh;
            position: relative;
        }

        #gameContainer {
            width: 400px;
            height: 600px;
            position: relative;
            overflow: hidden;
            background: linear-gradient(180deg, #4F46E5 0%, #6366F1 100%);
        }

        /* Yan Banner Reklamlar */
        .side-banner {
            width: 160px;
            height: 600px;
            background: white;
            position: relative;
            display: none; /* Mobilde gizle */
        }

        .side-banner.left {
            margin-right: 20px;
        }

        .side-banner.right {
            margin-left: 20px;
        }

        #bird {
            position: absolute;
            width: 40px;
            height: 40px;
            font-size: 30px;
            line-height: 40px;
            text-align: center;
            transform: translateY(-50%);
            z-index: 2;
        }

        .pipe {
            position: absolute;
            width: 60px;
            background: #22C55E;
            box-shadow: inset -2px 0 3px rgba(0, 0, 0, 0.3);
        }

        .pipe.top {
            border-bottom-left-radius: 5px;
            border-bottom-right-radius: 5px;
        }

        .pipe.bottom {
            border-top-left-radius: 5px;
            border-top-right-radius: 5px;
        }

        #score {
            position: absolute;
            top: 20px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 40px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            z-index: 3;
        }

        #gameOver {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.8);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            color: white;
            display: none;
            z-index: 4;
        }

        .btn {
            background: #6366F1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            margin: 10px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
        }

        .btn:hover {
            background: #4F46E5;
        }

        #startScreen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 5;
        }

        #ground {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100px;
            background: #854D0E;
            z-index: 1;
        }

        .coin {
            position: absolute;
            width: 30px;
            height: 30px;
            font-size: 20px;
            line-height: 30px;
            text-align: center;
            z-index: 2;
            animation: rotate 2s infinite linear;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .particle {
            position: absolute;
            pointer-events: none;
            animation: particle 0.8s ease-out forwards;
            font-size: 20px;
            font-weight: bold;
            color: gold;
            z-index: 3;
        }

        @keyframes particle {
            0% {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translateY(-50px) scale(0);
                opacity: 0;
            }
        }

        /* Alt Banner */
        .bottom-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 60px;
            background: white;
            z-index: 6;
        }

        /* Responsive TasarÄ±m */
        @media (min-width: 1200px) {
            .side-banner {
                display: block; /* GeniÅŸ ekranlarda yan bannerlarÄ± gÃ¶ster */
            }
        }

        @media (max-width: 480px) {
            #gameContainer {
                width: 100vw;
                height: calc(100vh - 60px); /* Alt banner iÃ§in boÅŸluk bÄ±rak */
            }
        }
    </style>
</head>
<body>
    <div id="gameWrapper">
        <!-- Sol Banner -->
        <div class="side-banner left" id="leftBanner">
            <!-- Banner reklam kodu buraya gelecek -->
        </div>

        <div id="gameContainer">
            <div id="score">0</div>
            <div id="bird">ðŸª™</div>
            <div id="ground"></div>
            
            <div id="startScreen">
                <h1>Flappy BONK</h1>
                <p>TÄ±kla veya Space tuÅŸuna bas</p>
                <button class="btn" onclick="startGame()">BAÅžLA</button>
            </div>
            
            <div id="gameOver">
                <h2>Oyun Bitti!</h2>
                <p>Skor: <span id="finalScore">0</span></p>
                <p>BONK KazancÄ±: <span id="bonkEarned">0</span></p>
                <button class="btn" onclick="watchAdToRevive()">âš¡ Reklam Ä°zle ve Devam Et</button>
                <button class="btn" onclick="restartGame()">Yeniden BaÅŸla</button>
            </div>
        </div>

        <!-- SaÄŸ Banner -->
        <div class="side-banner right" id="rightBanner">
            <script type="text/javascript">
            atOptions = {
                'key' : '1f9a30427590cf1c01a8b981bae675b2',
                'format' : 'iframe',
                'height' : 600,
                'width' : 160,
                'params' : {}
            };
            document.write('<scr' + 'ipt type="text/javascript" src="//ophoacit.com/1f9a30427590cf1c01a8b981bae675b2/invoke.js"></scr' + 'ipt>');
            </script>
        </div>
    </div>

    <!-- Alt Banner -->
    <div class="bottom-banner" id="bottomBanner">
        <script type="text/javascript">
        atOptions = {
            'key' : 'afe18f14ff46325c047c5ee44c947078',
            'format' : 'iframe',
            'height' : 60,
            'width' : 468,
            'params' : {}
        };
        document.write('<scr' + 'ipt type="text/javascript" src="//ophoacit.com/afe18f14ff46325c047c5ee44c947078/invoke.js"></scr' + 'ipt>');
        </script>
    </div>

    <script>
        // Telegram WebApp
        const tg = window.Telegram.WebApp;
        if (tg) tg.expand();

        // Oyun DeÄŸiÅŸkenleri
        const gameState = {
            isPlaying: false,
            score: 0,
            gravity: 0.5,
            jumpForce: -10,
            velocity: 0,
            birdPosition: 300,
            pipes: [],
            coins: [],
            gameLoop: null,
            pipeGap: 150,
            pipeInterval: 1500,
            lastPipeTime: 0,
            bonkEarned: 0
        };

        // DOM Elementleri
        const bird = document.getElementById('bird');
        const gameContainer = document.getElementById('gameContainer');
        const scoreElement = document.getElementById('score');
        const gameOverScreen = document.getElementById('gameOver');
        const startScreen = document.getElementById('startScreen');
        const finalScoreElement = document.getElementById('finalScore');
        const bonkEarnedElement = document.getElementById('bonkEarned');

        // Oyunu baÅŸlat
        function startGame() {
            startScreen.style.display = 'none';
            gameState.isPlaying = true;
            gameState.score = 0;
            gameState.bonkEarned = 0;
            gameState.pipes = [];
            gameState.coins = [];
            gameState.velocity = 0;
            gameState.birdPosition = 300;
            
            updateScore();
            
            if (gameState.gameLoop) clearInterval(gameState.gameLoop);
            gameState.gameLoop = setInterval(updateGame, 16);
            
            gameState.lastPipeTime = Date.now();
        }

        // ZÄ±plama
        function jump() {
            if (!gameState.isPlaying) return;
            gameState.velocity = gameState.jumpForce;
        }

        // Oyunu gÃ¼ncelle
        function updateGame() {
            if (!gameState.isPlaying) return;

            // KuÅŸ fiziÄŸi
            gameState.velocity += gameState.gravity;
            gameState.birdPosition += gameState.velocity;
            bird.style.top = gameState.birdPosition + 'px';

            // Borular
            const currentTime = Date.now();
            if (currentTime - gameState.lastPipeTime > gameState.pipeInterval) {
                createPipe();
                gameState.lastPipeTime = currentTime;
            }

            // Zorluk artÄ±ÅŸÄ±
            if (gameState.score > 0 && gameState.score % 10 === 0) {
                gameState.pipeGap = Math.max(90, gameState.pipeGap - 10);
            }
            if (gameState.score > 0 && gameState.score % 20 === 0) {
                gameState.pipeInterval = Math.max(1000, gameState.pipeInterval - 100);
            }

            // BorularÄ± hareket ettir ve kontrol et
            gameState.pipes.forEach((pipe, index) => {
                pipe.x -= 2;
                pipe.topElement.style.left = pipe.x + 'px';
                pipe.bottomElement.style.left = pipe.x + 'px';

                if (checkCollision(pipe)) {
                    gameOver();
                }

                if (!pipe.passed && pipe.x < 100) {
                    pipe.passed = true;
                    gameState.score++;
                    gameState.bonkEarned += 500;
                    updateScore();
                    createCoin(pipe.x + 30, pipe.y + gameState.pipeGap / 2);
                }

                if (pipe.x < -60) {
                    gameContainer.removeChild(pipe.topElement);
                    gameContainer.removeChild(pipe.bottomElement);
                    gameState.pipes.splice(index, 1);
                }
            });

            // Coinleri hareket ettir ve kontrol et
            gameState.coins.forEach((coin, index) => {
                coin.x -= 2;
                coin.element.style.left = coin.x + 'px';

                if (checkCoinCollision(coin)) {
                    gameContainer.removeChild(coin.element);
                    gameState.coins.splice(index, 1);
                    gameState.bonkEarned += 100;
                    createParticle(coin.x, coin.y, '+100');
                }

                if (coin.x < -30) {
                    gameContainer.removeChild(coin.element);
                    gameState.coins.splice(index, 1);
                }
            });

            // Zemin ve tavan kontrolÃ¼
            if (gameState.birdPosition > 520 || gameState.birdPosition < 0) {
                gameOver();
            }
        }

        // Boru oluÅŸturma
        function createPipe() {
            const gap = gameState.pipeGap;
            const height = Math.random() * (300 - 100) + 100;

            const topPipe = document.createElement('div');
            topPipe.className = 'pipe top';
            topPipe.style.height = height + 'px';
            topPipe.style.left = '400px';
            gameContainer.appendChild(topPipe);

            const bottomPipe = document.createElement('div');
            bottomPipe.className = 'pipe bottom';
            bottomPipe.style.height = (500 - height - gap) + 'px';
            bottomPipe.style.top = (height + gap) + 'px';
            bottomPipe.style.left = '400px';
            gameContainer.appendChild(bottomPipe);

            gameState.pipes.push({
                x: 400,
                y: height,
                topElement: topPipe,
                bottomElement: bottomPipe,
                passed: false
            });
        }

        // Coin oluÅŸturma
        function createCoin(x, y) {
            const coin = document.createElement('div');
            coin.className = 'coin';
            coin.textContent = 'ðŸª™';
            coin.style.left = x + 'px';
            coin.style.top = y + 'px';
            gameContainer.appendChild(coin);

            gameState.coins.push({
                x: x,
                y: y,
                element: coin
            });
        }

        // ParÃ§acÄ±k efekti
        function createParticle(x, y, text) {
            const particle = document.createElement('div');
            particle.className = 'particle';
            particle.textContent = text;
            particle.style.left = x + 'px';
            particle.style.top = y + 'px';
            gameContainer.appendChild(particle);

            setTimeout(() => {
                gameContainer.removeChild(particle);
            }, 800);
        }

        // Ã‡arpÄ±ÅŸma kontrolÃ¼
        function checkCollision(pipe) {
            const birdRect = {
                x: 80,
                y: gameState.birdPosition,
                width: 40,
                height: 40
            };

            const topPipeRect = {
                x: pipe.x,
                y: 0,
                width: 60,
                height: pipe.y
            };

            const bottomPipeRect = {
                x: pipe.x,
                y: pipe.y + gameState.pipeGap,
                width: 60,
                height: 500 - (pipe.y + gameState.pipeGap)
            };

            return rectIntersect(birdRect, topPipeRect) || rectIntersect(birdRect, bottomPipeRect);
        }

        // Coin Ã§arpÄ±ÅŸma kontrolÃ¼
        function checkCoinCollision(coin) {
            const birdRect = {
                x: 80,
                y: gameState.birdPosition,
                width: 40,
                height: 40
            };

            const coinRect = {
                x: coin.x,
                y: coin.y,
                width: 30,
                height: 30
            };

            return rectIntersect(birdRect, coinRect);
        }

        // DikdÃ¶rtgen Ã§arpÄ±ÅŸma kontrolÃ¼
        function rectIntersect(rect1, rect2) {
            return !(rect1.x + rect1.width < rect2.x ||
                    rect2.x + rect2.width < rect1.x ||
                    rect1.y + rect1.height < rect2.y ||
                    rect2.y + rect2.height < rect1.y);
        }

        // Skor gÃ¼ncelleme
        function updateScore() {
            scoreElement.textContent = gameState.score;
            finalScoreElement.textContent = gameState.score;
            bonkEarnedElement.textContent = gameState.bonkEarned;
        }

        // Oyun bitti
        function gameOver() {
            gameState.isPlaying = false;
            clearInterval(gameState.gameLoop);
            gameOverScreen.style.display = 'block';
            saveScore();
        }

        // Reklam izleyerek devam et
        async function watchAdToRevive() {
            try {
                await show_8946116();
                gameOverScreen.style.display = 'none';
                gameState.velocity = 0;
                gameState.birdPosition = 300;
                gameState.isPlaying = true;
                gameState.gameLoop = setInterval(updateGame, 16);
            } catch (error) {
                console.error('Reklam hatasÄ±:', error);
                restartGame();
            }
        }

        // Oyunu yeniden baÅŸlat
        function restartGame() {
            // Eski borularÄ± ve coinleri temizle
            gameState.pipes.forEach(pipe => {
                gameContainer.removeChild(pipe.topElement);
                gameContainer.removeChild(pipe.bottomElement);
            });
            gameState.coins.forEach(coin => {
                if (coin.element.parentNode) {
                    gameContainer.removeChild(coin.element);
                }
            });

            gameState.pipes = [];
            gameState.coins = [];
            gameOverScreen.style.display = 'none';
            startGame();
        }

        // Skor kaydetme
        async function saveScore() {
            if (!tg.initDataUnsafe?.user?.id) return;

            await DATABASE.games.updateGameStats(tg.initDataUnsafe.user.id, 'flappyBird', {
                score: gameState.score,
                bonkEarned: gameState.bonkEarned
            });
        }

        // Kontroller
        document.addEventListener('click', jump);
        document.addEventListener('keydown', (e) => {
            if (e.code === 'Space') {
                e.preventDefault();
                jump();
            }
        });

        // BaÅŸlangÄ±Ã§ ekranÄ±nÄ± gÃ¶ster
        startScreen.style.display = 'flex';
    </script>
</body>
</html>
